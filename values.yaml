# Default values for load-chart.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Migrations job configuration - runs database migrations
migrations:
  # Migrations job image (PostgreSQL client)
  image:
    repository: postgres
    tag: "16-alpine"
    pullPolicy: IfNotPresent

  # PostgreSQL connection details for migrations
  postgres:
    host: "load-chart-postgresql"
    port: "5432"
    database: "postgres"
    user: "postgres"
    password: "password"  # Should be overridden via values or secrets

  # Migrations job behavior settings
  backoffLimit: 3  # Number of retries before marking job as failed
  ttlSecondsAfterFinished: 300  # Delete job 5 minutes after completion

# Test job configuration - verifies migrations were applied
job:
  # Job-specific image (PostgreSQL client)
  image:
    repository: postgres
    tag: "16-alpine"
    pullPolicy: IfNotPresent

  # PostgreSQL connection details
  postgres:
    # Host should point to the PostgreSQL service name
    # Format: <release-name>-postgresql.<namespace>.svc.cluster.local
    # For same namespace deployment, just use: <release-name>-postgresql
    host: "load-chart-postgresql"
    port: "5432"
    database: "postgres"
    user: "postgres"
    password: "password"  # Should be overridden via values or secrets

  # Job behavior settings
  backoffLimit: 3  # Number of retries before marking job as failed
  ttlSecondsAfterFinished: 300  # Delete job 5 minutes after completion

# Cleanup job configuration - removes ArgoCD application after successful tests
cleanup:
  enabled: false  # Set to true to enable automatic cleanup

  # Cleanup job image (kubectl client)
  image:
    repository: bitnami/kubectl
    tag: latest
    pullPolicy: IfNotPresent

  # ArgoCD Application details
  applicationName: "load-chart"  # Name of the ArgoCD Application to delete
  applicationNamespace: "argocd"  # Namespace where ArgoCD Application exists

  # Cleanup job behavior settings
  backoffLimit: 2  # Number of retries before marking job as failed
  ttlSecondsAfterFinished: 60  # Delete job 1 minute after completion
  waitTimeout: 300  # Maximum time to wait for test job to complete (seconds)

# This is for the secrets for pulling an image from a private repository more information can be found here: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
imagePullSecrets: []
# This is to override the chart name.
nameOverride: ""
fullnameOverride: ""

# This section builds out the service account more information can be found here: https://kubernetes.io/docs/concepts/security/service-accounts/
serviceAccount:
  # Specifies whether a service account should be created.
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account.
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template.
  name: ""

# This is for setting Kubernetes Annotations to a Pod.
# For more information checkout: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/
podAnnotations: {}
# This is for setting Kubernetes Labels to a Pod.
# For more information checkout: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/
podLabels: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# Resource limits and requests for the job container
resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 50m
  #   memory: 64Mi

nodeSelector: {}

tolerations: []

affinity: {}

# ArgoCD configuration
# Sync waves control the order of resource deployment in ArgoCD
# Lower numbered waves are deployed first, and ArgoCD waits for them to be healthy before proceeding
argocd:
  migrations:
    # Sync wave for the database migrations job (default: 1)
    # Migrations run after wave 0 resources (PostgreSQL) are healthy
    syncWave: 1
  job:
    # Sync wave for the test job (default: 2)
    # Tests run after migrations complete successfully
    syncWave: 2
  cleanup:
    # Sync wave for the cleanup job (default: 3)
    # Cleanup runs after tests complete successfully
    syncWave: 3
  notification:
    # Sync wave for the notification job (default: 3)
    # Notifications sent after tests complete (success or failure)
    syncWave: 3

# Notification job configuration - sends Slack notifications about test results
notification:
  enabled: false  # Set to true to enable Slack notifications

  # Notification job image (curl for sending HTTP requests)
  image:
    repository: curlimages/curl
    tag: "8.5.0"
    pullPolicy: IfNotPresent

  # Slack webhook URL for sending notifications
  # Create a webhook at: https://api.slack.com/messaging/webhooks
  slackWebhookUrl: ""  # Must be set to a valid Slack webhook URL

  # Notification job behavior settings
  backoffLimit: 2  # Number of retries before marking job as failed
  ttlSecondsAfterFinished: 60  # Delete job 1 minute after completion
  waitTimeout: 300  # Maximum time to wait for test job to complete (seconds)

# PostgreSQL dependency configuration
# More information: https://github.com/bitnami/charts/tree/main/bitnami/postgresql
postgresql:
  enabled: true
  # ArgoCD sync wave annotation for PostgreSQL resources
  commonAnnotations:
    argocd.argoproj.io/sync-wave: "0"
  # Additional PostgreSQL values can be configured here
  # For example:
  auth:
    postgresPassword: "password"
  #   database: "mydb"
  # primary:
  #   persistence:
  #     enabled: true
  #     size: 8Gi

# RabbitMQ dependency configuration
# More information: https://github.com/bitnami/charts/tree/main/bitnami/rabbitmq
rabbitmq:
  enabled: true
  image:
    repository: bitnamilegacy/rabbitmq
    tag: 4.1.3-debian-12-r1
  # ArgoCD sync wave annotation for RabbitMQ resources
  commonAnnotations:
    argocd.argoproj.io/sync-wave: "0"
  # Additional RabbitMQ values can be configured here
  # For example:
  auth:
    password: "password"
  #   username: "myuser"
  #   erlangCookie: "changeme"